// Copyright 2000-2023 JetBrains s.r.o. and contributors. Use of this source code is governed by the Apache 2.0 license.
//file:noinspection GrPackage

static def disableSources(PluginContainer plugins) {
  def plugin = plugins.findPlugin(IdeaPlugin)
  if (plugin != null) {
    overridePluginSourcesPolicy(plugin)
  } else {
    plugins.whenPluginAdded { p ->
      if (p instanceof IdeaPlugin) {
        overridePluginSourcesPolicy(p)
      }
    }
  }
}

static def overridePluginSourcesPolicy(IdeaPlugin plugin) {
  def module = plugin?.model?.module
  if (module != null) {
    module.downloadJavadoc = false
    module.downloadSources = false
  }
}

allprojects {
  afterEvaluate {
    disableSources(plugins)
  }
}
